業務領貨單規格書 (SRO)
===
> 主要操作者：業務員
---

## 概述

業務員上班時，根據已配貨的明細 (AOD) 進行點貨確認，領取貨品至自己的儲位。
一次領取可包含來自多張配貨單 (AO) 的明細。

---

## 作業流程

```
┌─────────────────────────────────────────────────────────────────────────┐
│  階段 1: 查詢待領貨                                                      │
│  ───────────────                                                        │
│  - 業務員查詢自己的待領明細 (AOD.status = PENDING)                        │
│  - 可能來自多張 AO（不同配貨時間）                                        │
└─────────────────────────────────────────────────────────────────────────┘
        │
        ▼ 業務員點貨確認
┌─────────────────────────────────────────────────────────────────────────┐
│  階段 2: 確認領取                                                        │
│  ─────────────                                                          │
│  1. 業務員點貨，確認品項、批次、數量                                      │
│  2. 系統產生 SRO + SROD                                                  │
│  3. SROD 關聯來源 AOD                                                    │
│  4. 更新 AOD.status = RECEIVED                                          │
│  5. 庫存從大庫移轉至業務員儲位                                            │
└─────────────────────────────────────────────────────────────────────────┘
        │
        ▼
┌─────────────────────────────────────────────────────────────────────────┐
│  階段 3: 完成                                                            │
│  ─────────                                                              │
│  - 業務員儲位庫存增加                                                    │
│  - 可進行送貨作業                                                        │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 資料結構

### SalesReceiveOrder (SRO 業務領貨單)

| 欄位 | 型別 | 說明 |
|------|------|------|
| receiveNo | String | 領貨單號 (SRO + 流水號) |
| branchCode | String | 營業所代碼 |
| locationCode | String | 儲位代碼 |
| receiveDate | LocalDate | 領貨日期 |
| status | String | 狀態 (PENDING/RECEIVED) |
| receivedAt | LocalDateTime | 領取時間 |
| receivedBy | String | 領取人員 |

### SalesReceiveOrderDetail (SROD 業務領貨單明細)

| 欄位 | 型別 | 說明 |
|------|------|------|
| receiveNo | String | 領貨單號 |
| itemNo | Integer | 項次 |
| allocationNo | String | 來源配貨單號 |
| aodItemNo | Integer | 來源 AOD 項次 |
| productCode | String | 產品代碼 |
| batchNo | String | 批次號 |
| expiryDate | LocalDate | 效期 |
| qty | Integer | 領取數量 |

---

## SRO 狀態說明

| 狀態 | 說明 |
|------|------|
| PENDING | 待領取（系統產生，尚未確認） |
| RECEIVED | 已領取（業務員已確認領貨） |

---

## 單據關係

```
配貨 1: AO-1 ─┬─ AOD (F1 的貨) ──┐
              ├─ AOD (F2 的貨) ──┼─ 待領清單 ─┐
              └─ AOD (H1 的貨) ──┘            │
                                             ├─► 業務員 S 領貨 ─► SRO-1
配貨 2: AO-2 ─── AOD (H2 的貨) ─── 待領清單 ─┘            │
                                                         ▼
                                                  SRO-1 的 SROD
                                                  ├── 關聯 AO-1 的 AOD
                                                  └── 關聯 AO-2 的 AOD
```

### 關聯方式

- AOD : SROD = 1 : 1（一個 AOD 一次領完）
- AO : SRO = N : 1（一張 SRO 可包含多張 AO 的明細）

---

## API 設計

| 方法 | 端點 | 說明 | 操作者 |
|------|------|------|--------|
| GET | /api/sales-receive/pending | 查詢待領貨明細 | 業務員 |
| POST | /api/sales-receive/confirm | 確認領貨 | 業務員 |
| GET | /api/sales-receive | 查詢領貨單清單 | 業務員 |
| GET | /api/sales-receive/{receiveNo} | 查詢單一領貨單明細 | 業務員 |

---

## 庫存影響

### 領貨確認後

| 動作 | 說明 |
|------|------|
| 大庫庫存 | 已在配貨時扣減（預留） |
| 業務員儲位庫存 | 增加（含批次、效期） |

---

## 相關規格書

- [配貨單規格書](./AllocationOrder.md)
- [業務員訂貨規格書](../purchase/SalesPurchase.md)

---
