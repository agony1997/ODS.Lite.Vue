業務員寄庫單規格書 (SKR)
===
> 主要操作者：業務員
---

## 概述

業務員下班時，將車上未售出的有效貨品暫存回大庫冰存。
隔天上班時，寄庫貨品自動併入領貨單 (SRO) 領回。

> 儲位 = 車存，下班熄火後無法冷藏，需寄回大庫冰存。

---

## 作業流程

```
┌─────────────────────────────────────────────────────────────────────────┐
│  階段 1: 業務員下班                                                      │
│  ───────────────                                                        │
│  - 盤點車上剩餘有效貨品                                                   │
│  - 建立寄庫單 (SKR)                                                      │
│  - 貨品移至大庫冰存                                                      │
│  - 業務員儲位庫存 → 大庫（寄庫區）                                        │
└─────────────────────────────────────────────────────────────────────────┘
        │
        ▼ 隔天上班
┌─────────────────────────────────────────────────────────────────────────┐
│  階段 2: 自動領回                                                        │
│  ─────────────                                                          │
│  - SKR 併入當日 SRO（領貨單）                                            │
│  - 業務員確認領貨時一併領回                                               │
│  - 更新 SKR.status = RETRIEVED                                          │
│  - 大庫（寄庫區）→ 業務員儲位庫存                                        │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 資料結構

### SalesKeepRecord (SKR 業務員寄庫單)

| 欄位 | 型別 | 說明 |
|------|------|------|
| keepNo | String | 寄庫單號 (SKR + 流水號) |
| branchCode | String | 營業所代碼 |
| locationCode | String | 儲位代碼（業務員） |
| keepDate | LocalDate | 寄庫日期 |
| status | String | 狀態 |
| createdAt | LocalDateTime | 寄庫時間 |
| retrievedAt | LocalDateTime | 領回時間 |

### SalesKeepRecordDetail (SKRD 寄庫單明細)

| 欄位 | 型別 | 說明 |
|------|------|------|
| keepNo | String | 寄庫單號 |
| itemNo | Integer | 項次 |
| productCode | String | 產品代碼 |
| batchNo | String | 批次號 |
| expiryDate | LocalDate | 效期 |
| qty | Integer | 寄庫數量 |
| unit | String | 單位 |

---

## SKR 狀態說明

| 狀態 | 說明 |
|------|------|
| KEPT | 已寄庫（貨品在大庫寄庫區） |
| RETRIEVED | 已領回（併入 SRO 領回） |

---

## 庫存影響

### 寄庫時

| 儲位 | 變化 |
|------|------|
| 業務員儲位 | -qty |
| 大庫（寄庫區） | +qty |

### 領回時

| 儲位 | 變化 |
|------|------|
| 大庫（寄庫區） | -qty |
| 業務員儲位 | +qty（透過 SRO） |

---

## 與 SRO 的關係

```
隔天領貨時：

SRO (領貨單)
├── SROD (來自 AOD，當日配貨)
└── SROD (來自 SKR，昨日寄庫) ← 自動併入
```

---

## API 設計

| 方法 | 端點 | 說明 | 操作者 |
|------|------|------|--------|
| GET | /api/sales-keep | 查詢寄庫單清單 | 業務員 |
| POST | /api/sales-keep | 建立寄庫單 | 業務員 |
| GET | /api/sales-keep/pending | 查詢待領回的寄庫 | 業務員 |

---

## 相關規格書

- [業務領貨單規格書](../allocation/SalesReceiveOrder.md)
- [業務員退庫單規格書](./SalesReturnRecord.md)

---
