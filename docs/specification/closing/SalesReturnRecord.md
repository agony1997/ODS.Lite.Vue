業務員退庫單規格書 (SRR)
===
> 主要操作者：業務員
---

## 概述

業務員將報廢品（呆品、損壞、召回）退回大庫，由庫務後續處理。
庫務彙整後產生營業所銷退單 (BRO)，退回工廠銷毀。

---

## 作業流程

```
┌─────────────────────────────────────────────────────────────────────────┐
│  階段 1: 業務員退庫                                                      │
│  ───────────────                                                        │
│  - 識別報廢品（呆品/損壞/召回）                                           │
│  - 建立退庫單 (SRR)                                                      │
│  - 填寫退庫原因                                                          │
│  - 貨品移至大庫（待處理區）                                               │
│  - 業務員儲位庫存扣減                                                    │
└─────────────────────────────────────────────────────────────────────────┘
        │
        ▼ 庫務處理
┌─────────────────────────────────────────────────────────────────────────┐
│  階段 2: 庫務彙整                                                        │
│  ─────────────                                                          │
│  - 彙整多張 SRR                                                          │
│  - 產生營業所銷退單 (BRO)                                                │
│  - 更新 SRR.status = PROCESSED                                          │
└─────────────────────────────────────────────────────────────────────────┘
        │
        ▼ 退回工廠
┌─────────────────────────────────────────────────────────────────────────┐
│  階段 3: 工廠銷毀                                                        │
│  ─────────────                                                          │
│  - BRO 送出給工廠                                                        │
│  - 工廠確認收回                                                          │
│  - 更新 BRO.status = RETURNED                                           │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 資料結構

### SalesReturnRecord (SRR 業務員退庫單)

| 欄位 | 型別 | 說明 |
|------|------|------|
| returnNo | String | 退庫單號 (SRR + 流水號) |
| branchCode | String | 營業所代碼 |
| locationCode | String | 儲位代碼（業務員） |
| returnDate | LocalDate | 退庫日期 |
| status | String | 狀態 |
| createdAt | LocalDateTime | 退庫時間 |

### SalesReturnRecordDetail (SRRD 退庫單明細)

| 欄位 | 型別 | 說明 |
|------|------|------|
| returnNo | String | 退庫單號 |
| itemNo | Integer | 項次 |
| productCode | String | 產品代碼 |
| batchNo | String | 批次號 |
| expiryDate | LocalDate | 效期 |
| qty | Integer | 退庫數量 |
| reason | String | 退庫原因 |
| remark | String | 備註 |
| unit | String | 單位 |

---

## SRR 狀態說明

| 狀態 | 說明 |
|------|------|
| PENDING | 待處理（已退庫，等待庫務彙整） |
| PROCESSED | 已處理（已併入 BRO） |

---

## 退庫原因

| 原因代碼 | 說明 |
|----------|------|
| STALE | 呆品（含過期、即期、賣不動） |
| DAMAGED | 損壞 |
| RECALLED | 召回 |

---

## 庫存影響

### 退庫時

| 儲位 | 變化 |
|------|------|
| 業務員儲位 | -qty |
| 大庫（待處理區） | +qty |

### BRO 退回工廠後

| 儲位 | 變化 |
|------|------|
| 大庫（待處理區） | -qty |

---

## API 設計

| 方法 | 端點 | 說明 | 操作者 |
|------|------|------|--------|
| GET | /api/sales-return | 查詢退庫單清單 | 業務員 |
| POST | /api/sales-return | 建立退庫單 | 業務員 |
| GET | /api/sales-return/pending | 查詢待處理的退庫單 | 庫務 |

---

## 相關規格書

- [營業所銷退單規格書](./BranchReturnOrder.md)
- [業務員寄庫單規格書](./SalesKeepRecord.md)

---
